<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Architect Pro | Nexus Edition</title>
    <script src="https://cdn.jsdelivr.net/npm/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/plain-draggable@2.5.12/plain-draggable.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/leader-line-new@1.6.0/leader-line.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    
    <style>
        :root {
            --ss-green: #16c800;
            --ss-black: #050505;
            --ss-card: #121212;
            --ss-border: rgba(255,255,255,0.08);
            --ss-accent: #ff0055;
        }

        body, html {
            margin: 0; padding: 0;
            background-color: var(--ss-black);
            background-image: 
                linear-gradient(rgba(22, 200, 0, 0.05) 1px, transparent 1px),
                linear-gradient(90deg, rgba(22, 200, 0, 0.05) 1px, transparent 1px);
            background-size: 50px 50px;
            font-family: 'Inter', -apple-system, sans-serif;
            color: white; overflow: hidden; height: 100vh;
        }

        #app { width: 100vw; height: 100vh; position: relative; }

        /* --- LEFT PANEL: CONTROL HUD --- */
        .hud-ui {
            position: absolute; top: 20px; left: 20px; z-index: 100;
            background: rgba(10,10,10,0.95); border: 1px solid var(--ss-border);
            padding: 24px; border-radius: 12px; backdrop-filter: blur(20px); width: 280px;
            box-shadow: 0 30px 60px rgba(0,0,0,0.9);
        }

        .hud-header { border-bottom: 1px solid var(--ss-border); margin-bottom: 20px; padding-bottom: 10px; }
        .hud-header h1 { margin: 0; font-size: 0.8rem; letter-spacing: 5px; color: var(--ss-green); text-transform: uppercase; }
        
        /* --- RIGHT PANEL: PROJECT METRICS --- */
        .metrics-hud {
            position: absolute; top: 20px; right: 20px; z-index: 100;
            background: rgba(10,10,10,0.9); border: 1px solid var(--ss-border);
            padding: 20px; border-radius: 12px; width: 220px; text-align: right;
        }

        .metric-val { font-size: 1.5rem; font-weight: 900; color: var(--ss-green); font-family: monospace; }
        .metric-lbl { font-size: 0.6rem; text-transform: uppercase; color: #666; letter-spacing: 1px; }

        /* --- THE NODES --- */
        .node {
            position: absolute; width: 260px; 
            background: var(--ss-card); border: 1px solid var(--ss-border);
            border-radius: 8px; box-shadow: 0 20px 50px rgba(0,0,0,0.8);
            z-index: 10; transition: transform 0.2s, border-color 0.3s;
        }

        .drag-handle {
            height: 18px; background: #1a1a1a; cursor: grab;
            border-radius: 8px 8px 0 0; display: flex; align-items: center; justify-content: center;
            font-size: 10px; color: #333; letter-spacing: 2px;
        }

        .node-body { padding: 18px; }
        
        .node-title-input {
            background: transparent; border: none; color: white;
            font-weight: 900; font-size: 1.1rem; width: 100%; outline: none; margin-bottom: 8px;
        }

        /* --- WIREFRAME PREVIEW ICON --- */
        .wireframe-preview {
            height: 60px; background: #000; border: 1px dashed #333;
            margin: 10px 0; border-radius: 4px; display: flex; align-items: center; justify-content: center;
            font-size: 0.6rem; color: #444; overflow: hidden;
        }

        .node-meta { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-top: 10px; }
        
        select, input[type="number"] {
            background: #000; border: 1px solid var(--ss-border);
            color: #aaa; font-size: 0.65rem; padding: 6px; border-radius: 4px; outline: none;
        }

        /* Node State Classes */
        .node.type-marketing { border-top: 4px solid #00c3ff; }
        .node.type-sales { border-top: 4px solid var(--ss-green); }
        .node.type-ops { border-top: 4px solid var(--ss-accent); }

        .btn {
            background: #1a1a1a; color: white; border: 1px solid var(--ss-border);
            padding: 12px; font-weight: bold; font-size: 0.7rem; cursor: pointer;
            text-transform: uppercase; border-radius: 6px; transition: 0.2s;
            margin-top: 10px; width: 100%; display: block;
        }
        .btn-primary { background: var(--ss-green); color: black; border: none; }
        .btn:hover { background: #222; border-color: var(--ss-green); }

        .delete-btn { position: absolute; top: -10px; right: -10px; background: var(--ss-accent); border: none; border-radius: 50%; color: white; width: 22px; height: 22px; cursor: pointer; display: none; }
        .node:hover .delete-btn { display: block; }

    </style>
</head>
<body>

<div id="app">
    <div class="hud-ui">
        <div class="hud-header">
            <h1>// NEXUS_ARCHITECT</h1>
        </div>
        
        <label class="metric-lbl">Active Environment</label>
        <select class="btn" style="text-align: left;" v-model="activeProject" @change="loadProject">
            <option v-for="p in projects" :value="p">{{ p }}</option>
        </select>

        <button class="btn btn-primary" @click="createNode">Deploy New Node +</button>
        <button class="btn" @click="addProject">New Project Slot</button>
        <button class="btn" @click="exportPNG">Snapshot Map (PNG)</button>
        
        <div style="margin-top: 20px; border-top: 1px solid var(--ss-border); padding-top: 15px;">
            <label class="metric-lbl">Line Mode</label>
            <div style="display: flex; gap: 10px; margin-top: 10px;">
                <button class="btn" @click="lineMode = 'grid'" :style="lineMode=='grid' ? 'border-color:var(--ss-green)':''">Structure</button>
                <button class="btn" @click="lineMode = 'fluid'" :style="lineMode=='fluid' ? 'border-color:var(--ss-accent)':''">User Flow</button>
            </div>
        </div>
    </div>

    <div class="metrics-hud">
        <div class="metric-lbl">Estimated Build Cost</div>
        <div class="metric-val">${{ totalCost }}</div>
        <div class="metric-lbl" style="margin-top:15px;">Est. Delivery Time</div>
        <div class="metric-val">{{ totalHours }} Hours</div>
        <div class="metric-lbl" style="margin-top:15px;">Node Count</div>
        <div class="metric-val">{{ nodes.length }}</div>
    </div>

    <div id="canvas">
        <div 
            v-for="node in nodes" 
            :key="node.id" 
            :id="node.id"
            class="node"
            :class="['type-' + node.type, { root: node.isRoot }]"
            :style="{ left: node.x + 'px', top: node.y + 'px' }"
        >
            <div class="drag-handle">:: SYSTEM_NODE ::</div>
            <button class="delete-btn" @click="removeNode(node.id)">Ã—</button>
            
            <div class="node-body">
                <input v-model="node.title" class="node-title-input" @input="save">
                
                <div class="wireframe-preview">
                    <span v-if="node.layout === 'hero'">[ = HERO SECTION = ]</span>
                    <span v-if="node.layout === 'grid'">[ ::: DATA GRID ::: ]</span>
                    <span v-if="node.layout === 'form'">[ _ INPUT FORM _ ]</span>
                </div>

                <div class="node-meta">
                    <div>
                        <label class="metric-lbl">Function</label>
                        <select v-model="node.type" @change="save">
                            <option value="marketing">Marketing</option>
                            <option value="sales">Sales</option>
                            <option value="ops">Systems</option>
                        </select>
                    </div>
                    <div>
                        <label class="metric-lbl">Blueprint</label>
                        <select v-model="node.layout" @change="save">
                            <option value="hero">Hero Page</option>
                            <option value="grid">Inventory</option>
                            <option value="form">Contact</option>
                        </select>
                    </div>
                </div>

                <div class="node-meta" style="margin-top: 15px;">
                    <div>
                        <label class="metric-lbl">Dev Hours</label>
                        <input type="number" v-model.number="node.hours" @input="save">
                    </div>
                    <div>
                        <label class="metric-lbl">Complexity</label>
                        <select v-model="node.complexity" @change="save">
                            <option :value="100">Low</option>
                            <option :value="250">Mid</option>
                            <option :value="500">High</option>
                        </select>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    const { createApp, ref, onMounted, nextTick, computed } = Vue;

    createApp({
        setup() {
            const nodes = ref([]);
            const projects = ref(['Global_System']);
            const activeProject = ref('Global_System');
            const lineMode = ref('grid');
            const connections = [];

            // --- CALCULATIONS ---
            const totalCost = computed(() => {
                return nodes.value.reduce((sum, n) => sum + (n.hours * n.complexity), 0);
            });

            const totalHours = computed(() => {
                return nodes.value.reduce((sum, n) => sum + n.hours, 0);
            });

            // --- CORE LOGIC ---
            const save = () => {
                localStorage.setItem(`nexus_${activeProject.value}`, JSON.stringify(nodes.value));
                localStorage.setItem('nexus_projects', JSON.stringify(projects.value));
            };

            const loadProject = () => {
                connections.forEach(c => c.line.remove());
                connections.length = 0;
                const data = localStorage.getItem(`nexus_${activeProject.value}`);
                nodes.value = data ? JSON.parse(data) : [{ id: 'node-0', title: 'CENTRAL_HUB', x: 500, y: 100, isRoot: true, type: 'sales', layout: 'hero', hours: 5, complexity: 250, parent: null }];
                nextTick(() => nodes.value.forEach(n => initNode(n)));
            };

            const addProject = () => {
                const name = prompt("Project ID:");
                if(name) { projects.value.push(name); activeProject.value = name; loadProject(); }
            };

            const initNode = (nodeObj) => {
                const el = document.getElementById(nodeObj.id);
                const handle = el.querySelector('.drag-handle');
                const d = new PlainDraggable(el, { handle });

                if(nodeObj.parent) {
                    const line = new LeaderLine(
                        document.getElementById(nodeObj.parent),
                        el,
                        { 
                            color: lineMode.value === 'grid' ? '#16c800' : '#ff0055', 
                            dash: lineMode.value === 'grid' ? false : {animation: true},
                            size: 2, path: lineMode.value === 'grid' ? 'grid' : 'magnet'
                        }
                    );
                    connections.push({ id: nodeObj.id, line, d });
                }

                d.onMove = () => {
                    nodeObj.x = d.left; nodeObj.y = d.top;
                    connections.forEach(c => c.line?.position());
                    save();
                };
            };

            const createNode = () => {
                const id = 'node-' + Date.now();
                const newNode = { id, title: 'NEW_PROCESS', x: 500, y: 400, type: 'marketing', layout: 'grid', hours: 2, complexity: 100, parent: 'node-0' };
                nodes.value.push(newNode);
                nextTick(() => initNode(newNode));
                save();
            };

            const removeNode = (id) => {
                nodes.value = nodes.value.filter(n => n.id !== id);
                const idx = connections.findIndex(c => c.id === id);
                if(idx > -1) { connections[idx].line.remove(); connections.splice(idx, 1); }
                save();
            };

            const exportPNG = () => {
                html2canvas(document.body).then(canvas => {
                    const a = document.createElement('a');
                    a.href = canvas.toDataURL();
                    a.download = `${activeProject.value}_Architect.png`;
                    a.click();
                });
            };

            onMounted(() => {
                const p = localStorage.getItem('nexus_projects');
                if(p) projects.value = JSON.parse(p);
                loadProject();
            });

            return { nodes, projects, activeProject, totalCost, totalHours, createNode, removeNode, save, loadProject, addProject, exportPNG, lineMode };
        }
    }).mount('#app');
</script>

</body>
</html>
